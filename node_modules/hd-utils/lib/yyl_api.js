const util   = require('util')
const http = require("http")

class YYLAPI {
	constructor(lly_cfg){
		this.wid = lly_cfg.wid
		this.pwd = lly_cfg.pwd
	}

    send_redbag(money, callback){
    	let self = this
        let url = `http://www.yaoyaola.cn/index.php/wechat2/getcodes?wid=${this.wid}&pwd=${this.pwd}&count=1&maxmoney=${money}&minmoney=${money}&totalmoney=${money}&length=10&type=0`;
		http.get(url, function(req, ress) {
			var json = '';  
			req.on('data', function(data) {
				json += data;  
			});  
			req.on('end', function(){  
				var jsonOBJ = JSON.parse(json);
				if (jsonOBJ.errcode == "0") {
					let ret_url = `http://www.yaoyaola.cn/index.php/yao/klqrcode?wid=${self.wid}&qcode=${jsonOBJ.codelist[0].code}`;
					callback(null, ret_url);
				}
				else{
					callback(jsonOBJ.errmsg, null)
				}
			});  
		}).on('error', (e) => {
			callback(e.message, null)
        });
    }

}

module.exports = YYLAPI;